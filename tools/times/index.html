<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cronômetro Digital</title>
  <style>
    :root{
      --bg:#0f1226;
      --card:#161a34;
      --accent:#7c5cff;
      --accent-2:#19c37d;
      --text:#e9eaf6;
      --muted:#a5a8c2;
      --shadow: 0 20px 50px rgba(0,0,0,.35), 0 2px 10px rgba(0,0,0,.25);
      --radius: 20px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; display:grid; place-items:center; background: radial-gradient(1200px 800px at 80% 20%, #1b1f45 0%, var(--bg) 60%);
      color:var(--text); font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
    }
    .app{ width:min(920px, 92vw); padding:28px; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); box-shadow:var(--shadow);}
    .header{ display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:24px;}
    .title{ font-size:clamp(20px, 3vw, 28px); font-weight:700; letter-spacing:.4px;}
    .hint{ color:var(--muted); font-size:12.5px}

    .display{ user-select:none; display:flex; align-items:baseline; justify-content:center; gap:.4ch; font-variant-numeric: tabular-nums; letter-spacing: .5px; padding:18px 20px; border-radius:calc(var(--radius) - 6px); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.08); box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);}
    .time{ font-size: clamp(36px, 9vw, 74px); font-weight:800; }
    .ms{ font-size: clamp(16px, 4vw, 28px); opacity:.9; color: var(--accent-2)}

    .controls{ margin-top:18px; display:flex; flex-wrap:wrap; gap:12px; justify-content:center }
    button{ cursor:pointer; appearance:none; border:1px solid rgba(255,255,255,.10); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); color:var(--text); padding:12px 16px; border-radius:16px; font-weight:700; letter-spacing:.3px; min-width:120px; transition: transform .06s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease; box-shadow: 0 8px 20px rgba(0,0,0,.25);}
    .primary{ background: linear-gradient(180deg, var(--accent), color-mix(in oklab, var(--accent), black 20%)); }
    .success{ background: linear-gradient(180deg, var(--accent-2), color-mix(in oklab, var(--accent-2), black 20%)); }
    .danger{ background: linear-gradient(180deg, #ff5c80, #d34a6a); }

    .laps{ margin-top:18px; max-height:min(40vh, 360px); overflow:auto; padding:4px; border-radius:14px; border:1px solid rgba(255,255,255,.06)}
    .empty{ padding:16px; color:var(--muted); text-align:center}
    .lap{ display:grid; grid-template-columns: auto 1fr 1fr 1fr; gap:12px; align-items:center; padding:12px 14px; border-bottom:1px dashed rgba(255,255,255,.06) }
    .lap:last-child{ border-bottom:0 }
    .lap .idx{ color:var(--muted); font-weight:700 }
    .badge{ font-size:12px; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08) }
  </style>
</head>
<body>
  <main class="app">
    <div class="header">
      <div class="title">⏱️ Cronômetro Digital</div>
      <div class="hint">Espaço = Iniciar/Pausar · L = Volta · R = Zerar</div>
    </div>

    <section class="display">
      <div class="time" id="time">00:00:00</div>
      <div class="ms" id="ms">.00</div>
    </section>

    <div class="controls">
      <button class="primary" id="startStop">Iniciar</button>
      <button class="success" id="lap" disabled>Volta</button>
      <button class="danger" id="reset" disabled>Zerar</button>
    </div>

    <div class="laps" id="laps">
      <div class="empty" id="emptyMsg">Sem voltas ainda.</div>
    </div>
  </main>

  <script>
    const format = (msTotal) => {
      const total = Math.max(0, Math.floor(msTotal));
      const cs = Math.floor((total % 1000) / 10);
      const s  = Math.floor(total / 1000) % 60;
      const m  = Math.floor(total / 60000) % 60;
      const h  = Math.floor(total / 3600000);
      const pad = (n) => String(n).padStart(2,'0');
      return {h, m, s, cs, main: `${pad(h)}:${pad(m)}:${pad(s)}`, sub: `.${pad(cs)}`};
    };

    let running = false;
    let startRef = 0;
    let elapsed  = 0;
    let rafId    = 0;
    let lastLap  = 0;

    const $time = document.getElementById('time');
    const $ms   = document.getElementById('ms');
    const $startStop = document.getElementById('startStop');
    const $lap  = document.getElementById('lap');
    const $reset= document.getElementById('reset');
    const $laps = document.getElementById('laps');
    const $empty= document.getElementById('emptyMsg');

    const render = (t) => {
      const {main, sub} = format(t);
      $time.textContent = main;
      $ms.textContent = sub;
    };

    const tick = () => {
      const now = performance.now();
      const t = (now - startRef) + elapsed;
      render(t);
      rafId = requestAnimationFrame(tick);
    };

    const start = () => {
      if (running) return;
      running = true;
      startRef = performance.now();
      rafId = requestAnimationFrame(tick);
      $startStop.textContent = 'Pausar';
      $lap.disabled = false; $reset.disabled = false;
    };

    const pause = () => {
      if (!running) return;
      running = false;
      cancelAnimationFrame(rafId);
      elapsed += performance.now() - startRef;
      render(elapsed);
      $startStop.textContent = 'Retomar';
    };

    const toggle = () => running ? pause() : start();

    const reset = () => {
      running = false;
      cancelAnimationFrame(rafId);
      elapsed = 0; startRef = 0; lastLap = 0;
      render(0);
      $startStop.textContent = 'Iniciar';
      $lap.disabled = true; $reset.disabled = true;
      $laps.replaceChildren($empty);
    };

    const addLap = () => {
      const current = running ? (performance.now() - startRef + elapsed) : elapsed;
      const start = lastLap;           // início desta volta (desde 00:00)
      const end = current;             // total acumulado no clique da volta
      const duration = end - start;    // duração da volta
      lastLap = current;

      const fStart = format(start), fEnd = format(end), fDur = format(duration);

      // Primeira volta: remove mensagem vazia
      if ($empty && $laps.contains($empty)) $empty.remove();

      const row = document.createElement('div');
      row.className = 'lap';

      const idx = document.createElement('div');
      idx.className = 'idx';
      idx.textContent = `Volta ${$laps.querySelectorAll('.lap').length + 1}`;

      const cStart = document.createElement('div');
      cStart.innerHTML = `<span class="badge" title="Início da volta (desde 00:00)">${fStart.main}${fStart.sub}</span>`;

      const cEnd = document.createElement('div');
      cEnd.innerHTML = `<span class="badge" title="Total acumulado (fim da volta)">${fEnd.main}${fEnd.sub}</span>`;

      const cDur = document.createElement('div');
      cDur.innerHTML = `<span class="badge" title="Duração desta volta">+${fDur.main}${fDur.sub}</span>`;

      row.append(idx, cStart, cEnd, cDur); // agora 4 colunas: #, início, fim, duração
      $laps.prepend(row); // volta mais recente no topo
    };

    $startStop.addEventListener('click', toggle);
    $lap.addEventListener('click', addLap);
    $reset.addEventListener('click', reset);

    window.addEventListener('keydown', (e) => {
      if (e.target.matches('input, textarea, [contenteditable="true"]')) return;
      if (e.code === 'Space') { e.preventDefault(); toggle(); }
      if (e.key.toLowerCase() === 'l') { e.preventDefault(); if (!$lap.disabled) addLap(); }
      if (e.key.toLowerCase() === 'r') { e.preventDefault(); if (!$reset.disabled) reset(); }
    });

    render(0);
  </script>
</body>
</html>
